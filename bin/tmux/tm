#!/bin/bash

############################
#  Wrapper for Tmuxinator  #
############################

MUX_CONFIG_DIR=~/.config/tmuxinator

if [[ "$1" == "-d" ]]; then
    PS4='$LINENO: '
    set -x
    shift
fi

if [[ -z "$1" ]]; then
    echo "usage: tm SESSION_NAME"
    exit 2
fi

case $1 in
    '-'* )
        CMD=${1#-}; shift
        if [[ 'edit' == "$CMD"* ]] && [[ -z "$1" ]]; then
            tmuxinator edit "$(tm-session-name)"
        else
            tmuxinator "$CMD" "$@"
        fi;;
    * )
        SESSION_NAME=$1; shift
        if [[ ! -f $MUX_CONFIG_DIR/$SESSION_NAME.yml ]]; then
            erb name="$SESSION_NAME" "$MUX_CONFIG_DIR"/default.yml > "$MUX_CONFIG_DIR"/"$SESSION_NAME".yml
        fi

        root="$(tm-session-root --get "$SESSION_NAME")"
        tmuxinator start "$SESSION_NAME" root="${root}"
        tmux switch-client -t "$SESSION_NAME";;
esac

