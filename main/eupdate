#!/bin/bash

######################################
#  Runs System Maintenance Commands  #
######################################

source gutils.sh
source /home/bryan/Sync/bin/main/emaint.sh

# ---------- Main Logic ----------
_uname_output="$(uname -a)"
sys_info="${_uname_output,,}"

# >>> GENTOO
if [[ "${sys_info}" == *"gentoo"* ]]; then
    econfirm "sudo emerge --sync" && notify "Portage Package Database Sync is Complete."
    econfirm "ewatch"
    econfirm "sudo emerge --ask --update --deep --newuse --keep-going @world" && notify "Portage Package Updates are Complete."
    econfirm "sudo emerge --ask --depclean"
    econfirm "sudo revdep-rebuild"
    econfirm "sudo smart-live-rebuild"
    econfirm "ebvcheck -v"
    econfirm "elogv"
    econfirm "sudo dispatch-conf"
fi

# >>> DEBIAN
if [[ "${sys_info}" == *"debian"* ]]; then
    econfirm "sudo aptitude update"
    econfirm "sudo aptitude full-upgrade"
    econfirm "sudo apt autoremove"
fi

# >>> ALL
econfirm "sudo npm update --force -g"
econfirm "rustup update"
econfirm "pipx upgrade-all"
econfirm "sudo updatedb &"

if [[ "${sys_info}" == *"gentoo"* ]]; then
    echeck_kernel_version || notify "The sys-kernel/gentoo-sources package was upgraded, so the linux kernel needs to be rebuilt and reinstalled!"
fi

exit 0  # Fixes issue caused by nonzero return status from last econfirm
