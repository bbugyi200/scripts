#!/bin/bash

################################
#  Build ebuild Manifest File  #
################################

overlay_dir=/home/bryan/Dropbox/portage

if [[ -z "$1" ]] || [[ -z "$2" ]]; then
    echo "usage: $(basename "$0") CATEGORY PACKAGE"
    exit 2
fi

category="$1"; shift
package="$1"; shift

count="$(find /home/bryan/Downloads -name "$package*" | wc -l)"
if [[ "$count" -gt 1 ]]; then
    echo "Multiple files match that package description."
    exit 1
fi

ebuild="$(find /home/bryan/Downloads -name "$package*")"

mkdir -p "$overlay_dir"/"$category"/"$package"
mv "$ebuild" "$overlay_dir"/"$category"/"$package"/
pushd "$overlay_dir"/"$category"/"$package" || exit 1
repoman manifest

echo 
confirm "git commit -m 'Add: $package package'"
confirm "git push"

popd || exit 1
