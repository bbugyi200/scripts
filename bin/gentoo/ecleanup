#!/bin/bash

######################################################################
#  Runs periodic maintenance tasks meant to cleanup the filesystem.  #
######################################################################

# ---------- Main Logic ----------
confirm "sort_qb_quickmarks"

confirm "sudo eclean --deep packages"
confirm "sudo eclean --deep distfiles"

D="/home/bryan/.local/share/Trash/files"
xprint -x "ls -a $D"
confirm "rm -rf $D && mkdir $D"

D="/root/.local/share/Trash/files"
sudo -i xprint -x "ls -a $D"
confirm "sudo rm -rf $D && sudo mkdir $D"

D="/home/bryan/Downloads"
xprint -x "ls -a $D"
confirm "safe-rm -rf $D && mkdir $D"

xprint -x "ls -a /var/tmp/*.log"
confirm "safe-rm /var/tmp/*.log"

if [[ -n "$(find /home/bryan/.config/tmuxinator/ -type f -name "*.yml" -atime +60)" ]]; then
    xprint -D 2 "\nTmuxinator sessions that have not been used in over 60 days:\n"
    find /home/bryan/.config/tmuxinator/ -type f -name "*.yml" -atime +60 -execdir confirm "safe-rm {}" ";"
fi

# ---------- Write timestamp to file ----------
DATA_DIR=/home/$USER/.local/share/"$(basename "$0")"
[[ -d $DATA_DIR ]] || mkdir "$DATA_DIR"

TIMESTAMP_FILE=$DATA_DIR/timestamp
date +"%m/%d/%y" > "$TIMESTAMP_FILE"
