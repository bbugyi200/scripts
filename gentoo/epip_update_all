#!/bin/bash

EPIP_PY2_PACKAGES=(
    IPython
)

EPIP_PY3_PACKAGES=(
    IPython
    loguru  # my personal scripts use loguru
    pandas
    parameterized
    pudb
    pygobject  # clipster dependency
    requests
    selenium
    tldextract  # qute-pass dependency
    typing-extensions
    redis
    pymongo
    pyzmq
    more-itertools
)
EPIP_SINGLE_TARGET_PACKAGES=(
    scalene  # CPU/Memory CLI profiling tool
)

function run() {
    pyver="$1"; shift
    packages=("$@"); shift

    epip_install -v "${pyver}" "${packages[@]}"

    printf "\n"
}

function single_target_packs() {
    local pyver="$1"; shift

    primary_version="$(eselect python show | perl -nE 'print s/^[^0-9]*(.*)/\1/gr')"
    if [[ "${pyver}" == "${primary_version}" ]]; then
        echo "${EPIP_SINGLE_TARGET_PACKAGES[@]}"
    else
        python"${pyver}" -m pip uninstall -y "${EPIP_SINGLE_TARGET_PACKAGES[@]}" &> /dev/null
    fi
}

run 2.7 "${EPIP_PY2_PACKAGES[@]}"

for pyver in $(python_versions | grep -v "^2" | sort -u); do
    run "${pyver}" "${EPIP_PY3_PACKAGES[@]}" $(single_target_packs "${pyver}")
done
