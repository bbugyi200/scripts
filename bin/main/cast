#!/usr/bin/env python

""" Wrapper for castnow """

import argparse
import subprocess as sp
import sys

import gutils
import videos

log = gutils.logging.getEasyLogger(__name__)

PLAYER_CONTROLS = """
========================================
=       CASTNOW PLAYER CONTROLS        =
========================================

space   // toggle between play and pause
m       // toggle mute
t       // toggle subtitles
up      // volume up
down    // volume down
left    // seek backward (keep pressed / multiple press for faster seek)
right   // seek forward (keep pressed / multiple press for faster seek)
n       // next item in the playlist (only supported in launch-mode)
s       // stop playback
q       // quit
"""


def main():
    video_file = videos.get('video')

    opts = [video_file]

    if video_file.endswith('.avi'):
        opts.extend(['--tomp4'])

    if args.subs:
        srt_file = videos.get('subs')
        if srt_file is not None:
            opts.extend(['--subtitles', srt_file])

    print(PLAYER_CONTROLS)

    cmd_list = ['castnow']
    cmd_list.extend(opts)
    sp.check_call(cmd_list)


if __name__ == "__main__":
    parser = argparse.ArgumentParser(description=__doc__)
    parser.add_argument('--nosubs', dest='subs', action='store_false', help='disables subtitle file prompt')
    parser.add_argument('-d', '--debug', action='store_true', help='enable debugging mode')
    args = parser.parse_args()

    if args.debug:
        gutils.logging.enableDebugMode(log)

    try:
        main()
    except RuntimeError as e:
        log.error(str(e))
        sys.exit(1)
    except Exception as e:
        log.error('{}: {}'.format(type(e).__name__, str(e)))
        raise
