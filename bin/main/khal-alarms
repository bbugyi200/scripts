#!/bin/bash

if [[ "$1" == "-d" ]]; then
    PS4='$LINENO: '
    set -x
fi

get_next_time() { echo $(khal list --notstarted --day-format '' now | head -n 1 | awk -F'-' '{ print $1; }'); }

new_time="$(get_next_time $k)"
while [[ "$new_time" != "No events" ]]; do
    alarm "$new_time"

    if [[ "$?" -ne 0 ]]; then
        break
    fi
    new_time="$(get_next_time $k)"
done
