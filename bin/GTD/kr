#!/usr/bin/env python

"""Sets Event with khal using RELATIVE Time (x minutes from now)"""

import datetime as dt
import subprocess as sp

import gutils

#######################################################################################
#  gutils library: https://github.com/bbugyi200/scripts/tree/master/pymodules/gutils  #
#######################################################################################

log = gutils.logging.getEasyLogger(__name__)


if __name__ == "__main__":
    parser = gutils.ArgumentParser()
    parser.add_argument('minutes', nargs='?', type=int, default=50,
                        help='Number of minutes, offset from now, the next break will be set for.')
    parser.add_argument('-n', nargs='+', dest='event_name', metavar='WORD',
                        default=('Study', 'Break',),
                        help='Name of the khal event that will be created.')
    args = parser.parse_args()

    with gutils.logging.context(log, debug=args.debug, verbose=args.verbose):
        breaktime_dt = dt.datetime.now() + dt.timedelta(minutes=args.minutes)

        cmd_list = ['khal', 'new', '-a', 'daily']
        cmd_list.append(breaktime_dt.strftime('%Y-%m-%dT%H:%M'))
        cmd_list.append(' '.join(args.event_name))
        sp.check_call(cmd_list)

        sp.Popen(['calalrms'], stdout=sp.DEVNULL, stderr=sp.STDOUT)
