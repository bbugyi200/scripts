#!/bin/bash

######################################################################
#  Runs periodic maintenance tasks meant to cleanup the filesystem.  #
######################################################################

source /home/bryan/Dropbox/scripts/modules/bash/gutils.sh
source /home/bryan/Dropbox/scripts/modules/bash/emaint.sh

# ---------- Main Logic ----------
TMP=/home/bryan/Dropbox/tmp
[ -d "$TMP" ] && rm -rf "$TMP"
mkdir "$TMP"

econfirm "sort_qb_quickmarks"
econfirm "efixsets"
econfirm "sudo eclean --deep packages"
econfirm "sudo eclean --deep distfiles"

D="/home/bryan/.local/share/Trash/files"
econfirm "sudo rm -rf $D && mkdir $D" "xprint -x 'ls -a $D'"

D="/root/.local/share/Trash/files"
econfirm "sudo rm -rf $D && sudo mkdir $D" "sudo -i xprint -x 'ls -a $D'"

D="/home/bryan/Downloads"
econfirm "safe-rm -rf $D && mkdir $D" "xprint -x 'ls -a $D'"

econfirm "sudo safe-rm /var/tmp/*.log" "xprint -x 'ls -a /var/tmp/*.log'"

if [[ -n "$(find /home/bryan/.config/tmuxinator/ -type f -name "*.yml" -atime +60)" ]]; then
    xprint -D 2 "\nTmuxinator sessions that have not been used in over 60 days:\n"
    find /home/bryan/.config/tmuxinator/ -type f -name "*.yml" -atime +60 -execdir confirm "safe-rm {}" ";"
fi
