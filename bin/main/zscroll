#!/bin/bash

##############################################################
#  Used to Scroll Zathura Up and Down in a Smoother Fashion  #
##############################################################

eval set -- "$(getopt -o "d,D,i,o,U" -l "debug,down,in,out,up" -- "$@")"

while [[ -n "$1" ]]; do
    case $1 in
       -d|--debug )
           PS4='$LINENO: '
           set -x
           ;;
       -D|--down )
           direction="down"
           ;;
       -i|--in )
           zoom="in"
           ;;
       -o|--out )
           zoom="out"
           ;;
       -U|--up )
           direction="up"
           ;;
       -- )
           shift
           break
           ;;
    esac
    shift
done

TMP=/tmp/"$(basename "$0")"
[ -d "$TMP" ] || mkdir "$TMP"

PAGE_FIT_MARKER="$TMP"/page-fit
if [[ -n "$zoom" ]]; then
    case "$zoom" in
        "in" )
            touch "$PAGE_FIT_MARKER"
            xtype "a"
            ;;
        "out" )
            rm "$PAGE_FIT_MARKER"
            xtype "Z"
            ;;
    esac

    exit 0
fi

if [[ -z "$direction" ]]; then
    echo "usage: $(basename "$0") [-U | -D]"
    exit 2
fi

case "$direction" in
    "up" )
        next_page_keys=KL
        scroll_key=H
        other_direction="down"
        ;;
    "down" )
        next_page_keys=JH
        scroll_key=L
        other_direction="up"
        ;;
esac

KEYS="$next_page_keys"
if [[ -f "$PAGE_FIT_MARKER" ]]; then
    [ -f "$TMP"/"$direction" ] && rm "$TMP"/"$direction"
    [ -f "$TMP"/"$other_direction" ] && rm "$TMP"/"$other_direction"
elif [[ -f "$TMP"/"$direction" ]]; then
    rm "$TMP"/"$direction"
    touch "$TMP"/"$other_direction"
else
    KEYS="$scroll_key"
    touch "$TMP"/"$direction"
    [ -f "$TMP"/"$other_direction" ] && rm "$TMP"/"$other_direction"
fi

xtype "$KEYS"
