#!/usr/bin/env bash

set -e

fname="$1"
shift

vim -c "goto 1" \
    -c "/^\[" \
    -c "nnoremap <nowait> x :normal 0lclX<Esc>/^\[ \]<CR>:w<CR>" \
    -c "nnoremap - :normal 0lcl-<Esc>/^\[<CR>:w<CR>" \
    -c "nnoremap <Space> :normal 0lcl <Esc>/^\[ \]<CR>:w<CR>" \
    -c "nnoremap <Leader><Space> :%s/\[.\]/[ ]/g<CR>gg/^\[<CR>:w<CR>" \
    -c "nnoremap <nowait> [ ?\[<CR>" \
    -c "nnoremap <nowait> ] /\[<CR>" \
    "$@" \
    "${fname}"

perl 1>&2 -nE 'print if /^\[/' "${fname}"
perl -i -nE 'print s/\[.\]/[ ]/gr' "${fname}"
