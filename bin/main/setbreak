#!/usr/bin/env python

""" Sets Break Event with khal """

import argparse
import datetime as dt
import subprocess as sp
import sys

import gutils

log = gutils.logging.getEasyLogger(__name__)


def main():
    breaktime_dt = dt.datetime.now() + dt.timedelta(minutes=args.minutes)
    gutils.sp.shell('khal new {} "{}"'.format(breaktime_dt.strftime('%Y-%m-%d %H:%M'), args.event_name))
    sp.Popen(['calalrms'])


if __name__ == "__main__":
    minutes_help = 'how many minutes from now the next break will be set for'
    event_name_help = 'name of the khal event that will be created'

    parser = argparse.ArgumentParser(description=__doc__)
    parser.add_argument('minutes', nargs='?', type=int, default=50, help=minutes_help)
    parser.add_argument('-n', dest='event_name', default='Study Break', help=event_name_help)
    parser.add_argument('-d', '--debug', action='store_true', help='enable debugging mode')
    args = parser.parse_args()

    if args.debug:
        gutils.logging.enableDebugMode(log)

    try:
        main()
    except RuntimeError as e:
        log.error(str(e))
        sys.exit(1)
    except Exception as e:
        log.error('{}: {}'.format(type(e).__name__, str(e)))
        raise
