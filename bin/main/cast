#!/usr/bin/env python

""" Wrapper for castnow """

import subprocess as sp

import gutils
import videos

log = gutils.logging.getEasyLogger(__name__)

PLAYER_CONTROLS = """
========================================
=       CASTNOW PLAYER CONTROLS        =
========================================

space   // toggle between play and pause
m       // toggle mute
t       // toggle subtitles
up      // volume up
down    // volume down
left    // seek backward (keep pressed / multiple press for faster seek)
right   // seek forward (keep pressed / multiple press for faster seek)
n       // next item in the playlist (only supported in launch-mode)
s       // stop playback
q       // quit
"""


if __name__ == "__main__":
    parser = gutils.ArgumentParser()
    parser.add_argument('--nosubs', dest='subs', action='store_false', help='disables subtitle file prompt')
    args = parser.parse_args()

    with gutils.logging.context(log, debug=args.debug):
        video_file = videos.get('video')

        opts = [video_file]

        if video_file.endswith('.avi'):
            opts.extend(['--tomp4'])

        if args.subs:
            srt_file = videos.get('subs')
            if srt_file is not None:
                opts.extend(['--subtitles', srt_file])

        print(PLAYER_CONTROLS)

        cmd_list = ['castnow']
        cmd_list.extend(opts)
        sp.check_call(cmd_list)
