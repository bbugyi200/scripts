#!/usr/bin/env python

""" Sets Break Event with khal """

import datetime as dt
import subprocess as sp

import gutils

#######################################################################################
#  gutils library: https://github.com/bbugyi200/scripts/tree/master/pymodules/gutils  #
#######################################################################################

log = gutils.logging.getEasyLogger(__name__)


if __name__ == "__main__":
    minutes_help = 'how many minutes from now the next break will be set for'
    event_name_help = 'name of the khal event that will be created'

    parser = gutils.ArgumentParser()
    parser.add_argument('minutes', nargs='?', type=int, default=50, help=minutes_help)
    parser.add_argument('-n', nargs='+', dest='event_name', default='Study Break', help=event_name_help)
    args = parser.parse_args()

    with gutils.logging.context(log, debug=args.debug):
        breaktime_dt = dt.datetime.now() + dt.timedelta(minutes=args.minutes)
        cmd_fmt = 'khal new -a daily {} "{}"'
        sp.check_call(cmd_fmt.format(breaktime_dt.strftime('%Y-%m-%d %H:%M'), ' '.join(args.event_name)),
                      shell=True)
        sp.Popen(['calalrms'])
