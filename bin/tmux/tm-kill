#!/bin/bash

socket_name="$(tm-socket)"

if [[ -n "$socket_name" ]]; then
    session_name=$(tmux -L "$socket_name" display-message -p "#S")
    N=$(tmux -L "$socket_name" ls | wc -l)
    prompt="Confirm 'kill-session'? (y/n)"

    if [[ "$N" -gt 1 ]]; then
        tmux -L "$socket_name" confirm-before -p "$prompt" " run-shell 'tmux switch-client -l || tmux switch-client -n'; run-shell 'tmuxinator stop $session_name'; refresh-client -S"
    else
        tmux -L "$socket_name" confirm-before -p "$prompt" "run-shell 'tmuxinator stop $session_name'"
    fi
else
    exit 1
fi
